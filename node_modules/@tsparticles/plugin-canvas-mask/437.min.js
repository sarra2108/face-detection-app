/*! For license information please see 437.min.js.LICENSE.txt */
(this.webpackChunk_tsparticles_plugin_canvas_mask=this.webpackChunk_tsparticles_plugin_canvas_mask||[]).push([[437],{437:(t,e,n)=>{n.d(e,{CanvasMaskInstance:()=>c});var i=n(303);const o={x:0,y:0};function a(t,e,n,o,a,s){const{height:c,width:h}=e,l=c*h,u=function(t){const e=1,n=0;for(let o=t.length-e;o>=n;o--){const e=Math.floor((0,i.getRandom)()*o);[t[o],t[e]]=[t[e],t[o]]}return t}(r(l)),g=Math.min(l,t.actualOptions.particles.number.value),f=t.canvas.size;let x=0;const d=f.width*n.x/i.percentDenominator-h*o*.5,m=f.height*n.y/i.percentDenominator-c*o*.5;for(;x<g&&u.length;){const n=0,i=u.pop()??n,r={x:i%h,y:Math.floor(i/h)},c=e.pixels[r.y][r.x];if(!s(c))continue;const l={x:r.x*o+d,y:r.y*o+m},g={};a.color&&(g.color={value:c}),a.opacity&&(g.opacity={value:c.a}),t.particles.addParticle(l,g),x++}}function s(t,e,n,i=!0){const a=t.getImageData(o.x,o.y,e.width,e.height).data;i&&t.clearRect(o.x,o.y,e.width,e.height);const s=[];for(let t=0;t<a.length;t+=n){const i=t/n,o={x:i%e.width,y:Math.floor(i/e.width)};s[o.y]||(s[o.y]=[]);const r={r:0,g:1,b:2,a:3},c=255;s[o.y][o.x]={r:a[t+r.r],g:a[t+r.g],b:a[t+r.b],a:a[t+r.a]/c}}return{pixels:s,width:Math.min(...s.map((t=>t.length))),height:s.length}}const r=t=>[...Array(t).keys()];class c{constructor(t){this._container=t}async init(){const t=this._container,e=t.actualOptions.canvasMask;if(!e?.enable)return;let n={pixels:[],height:0,width:0};const r=e.pixels.offset;if(e.image){const t=e.image.src;if(!t)return;n=await function(t,e){const n=new Image;n.crossOrigin="Anonymous";const a=new Promise(((t,a)=>{n.onerror=a,n.onload=()=>{const r=document.createElement("canvas");r.width=n.width,r.height=n.height;const c=r.getContext("2d");if(!c)return a(new Error(`${i.errorPrefix} Could not get canvas context`));c.drawImage(n,o.x,o.y,n.width,n.height,o.x,o.y,r.width,r.height),t(s(c,r,e))}}));return n.src=t,a}(t,r)}else if(e.text){const t=function(t,e){const n=document.createElement("canvas"),a=n.getContext("2d"),{font:r,text:c,lines:h,color:l}=t;if(!c||!a)return;const u=c.split(h.separator),g=(0,i.isNumber)(r.size)?`${r.size}px`:r.size,f=[];let x=0,d=0;for(const t of u){a.font=`${r.style??""} ${r.variant??""} ${r.weight??""} ${g} ${r.family}`;const e=a.measureText(t),n={measure:e,text:t,height:e.actualBoundingBoxAscent+e.actualBoundingBoxDescent,width:e.width};x=Math.max(x||0,n.width),d+=n.height+h.spacing,f.push(n)}n.width=x,n.height=d;let m=0;for(const t of f)a.font=`${r.style??""} ${r.variant??""} ${r.weight??""} ${g} ${r.family}`,a.fillStyle=l,a.fillText(t.text,o.x,m+t.measure.actualBoundingBoxAscent),m+=t.height+h.spacing;return s(a,n,e)}(e.text,r);if(!t)return;n=t}else if(e.element??e.selector){const t=e.element??(e.selector&&document.querySelector(e.selector));if(!t)return;const i=t.getContext("2d");if(!i)return;n=s(i,t,r)}a(t,n,e.position,e.scale,e.override,e.pixels.filter)}}}}]);